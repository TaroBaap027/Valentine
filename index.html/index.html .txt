<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tanishq ‚ù§Ô∏è Nisha</title>

  <style>
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top, #ffe3ee, #ffffff);
      padding: 24px;
      overflow:hidden;
    }
    .card{
      width:min(620px, 100%);
      background: rgba(255,255,255,0.92);
      border-radius: 22px;
      padding: 34px;
      text-align:center;
      box-shadow: 0 20px 45px rgba(0,0,0,0.12);
      position: relative;
      z-index: 2;
      backdrop-filter: blur(6px);
    }
    h1{ font-size: 34px; margin: 0 0 10px; }
    .from{ font-size: 14px; opacity: .75; margin-bottom: 18px; }

    .btns{
      display:flex;
      gap: 14px;
      justify-content:center;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    button{
      border:none;
      border-radius: 999px;
      padding: 14px 26px;
      font-size: 16px;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,0.12);
      transition: transform .08s ease, opacity .15s ease;
      user-select:none;
      touch-action: manipulation;
    }
    button:active{ transform: scale(0.97); }
    button[disabled]{ cursor:not-allowed; opacity:.65; }

    #yes{ background:#ff3b7a; color:#fff; }

    #no{
      background:#111; color:#fff;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(90px, 30px);
      z-index: 3;
    }

    .result{
      margin-top: 18px;
      font-size: 18px;
      font-weight: 650;
      min-height: 28px;
    }

    .finalScreen{
      display:none;
      margin-top: 16px;
      padding: 18px 16px;
      border-radius: 18px;
      background: rgba(255, 59, 122, 0.08);
      border: 1px solid rgba(255, 59, 122, 0.22);
    }
    .finalTitle{
      font-size: 28px;
      font-weight: 800;
      margin: 0 0 6px;
    }
    .finalSub{
      margin: 0;
      font-size: 16px;
      opacity: .85;
    }

    .musicTip{
      margin-top: 10px;
      font-size: 12px;
      opacity: .65;
    }

    .msgBox{
      margin-top: 18px;
      text-align: left;
      display:none;
    }
    .msgBox label{
      display:block;
      font-size: 13px;
      opacity: .8;
      margin-bottom: 8px;
    }
    textarea{
      width: 100%;
      min-height: 110px;
      resize: vertical;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      outline: none;
      font-size: 14px;
      font-family: inherit;
    }
    .sendRow{
      display:flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .secondary{
      background:#fff;
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: none;
      color:#111;
    }
    .status{
      margin-top: 10px;
      font-size: 13px;
      opacity: .78;
      min-height: 18px;
    }

    .confetti{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }
    .piece{
      position:absolute;
      top:-10px;
      width:10px;
      height:14px;
      border-radius: 4px;
      animation: fall linear forwards;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(540deg); }
    }

    #ytWrap{
      position: fixed;
      width: 1px;
      height: 1px;
      left: -9999px;
      top: -9999px;
      opacity: 0;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Nisha, will you be my Valentine? üíò</h1>
    <div class="from">‚Äî from Tanishq</div>

    <div class="btns">
      <button id="yes">Yes üíñ</button>
    </div>

    <div class="result" id="result"></div>

    <!-- Final screen -->
    <div class="finalScreen" id="finalScreen" role="status" aria-live="polite">
      <p class="finalTitle">m155 youuu</p>
      <p class="finalSub">can't wait to see you soon</p>
    </div>

    <div class="musicTip" id="musicTip">Tap anywhere once to start the music üé∂</div>

    <div class="msgBox" id="msgBox">
      <label for="message">Message back to Tanishq üíå</label>
      <textarea id="message" placeholder="Write something cute here..."></textarea>
      <div class="sendRow">
        <button class="secondary" id="clear" type="button">Clear</button>
        <button id="sendMsg" type="button">Send to Tanishq ‚ú®</button>
      </div>
      <div class="status" id="status"></div>
    </div>
  </div>

  <button id="no" aria-hidden="true">No üôÉ</button>
  <div class="confetti" id="confetti"></div>

  <!-- Background music: Gehra Hua (YouTube). Starts muted; first tap enables sound. -->
  <div id="ytWrap">
    <iframe
      id="ytPlayer"
      width="1"
      height="1"
      src="https://www.youtube.com/embed/2kvtJL8Keog?autoplay=1&loop=1&playlist=2kvtJL8Keog&mute=1"
      title="Gehra Hua"
      frameborder="0"
      allow="autoplay; encrypted-media"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen>
    </iframe>
  </div>

  <script>
    /***************
     * REQUIRED FOR EMAIL NOTIFICATIONS:
     * Replace with your Formspree endpoint, e.g.:
     * const FORMSPREE_ENDPOINT = "https://formspree.io/f/abcdwxyz";
     ***************/
    const FORMSPREE_ENDPOINT = "YOUR_FORMSPREE_ENDPOINT";

    const yesBtn = document.getElementById("yes");
    const noBtn = document.getElementById("no");
    const result = document.getElementById("result");
    const confetti = document.getElementById("confetti");
    const msgBox = document.getElementById("msgBox");
    const messageEl = document.getElementById("message");
    const statusEl = document.getElementById("status");
    const musicTip = document.getElementById("musicTip");
    const ytPlayer = document.getElementById("ytPlayer");
    const finalScreen = document.getElementById("finalScreen");

    const sendMsgBtn = document.getElementById("sendMsg");
    const clearBtn = document.getElementById("clear");

    const hasEndpoint = () =>
      !!FORMSPREE_ENDPOINT &&
      !FORMSPREE_ENDPOINT.includes("YOUR_FORMSPREE_ENDPOINT");

    // --- Confetti
    function celebrate(){
      confetti.innerHTML = "";
      const colors = ["#ff3b7a","#ffd1dc","#ffb703","#8ecae6","#8338ec","#06d6a0"];
      for(let i=0;i<130;i++){
        const p = document.createElement("div");
        p.className = "piece";
        p.style.left = Math.random()*100 + "vw";
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        p.style.animationDuration = (2 + Math.random()*2.2) + "s";
        p.style.width = (6 + Math.random()*8) + "px";
        p.style.height = (10 + Math.random()*10) + "px";
        confetti.appendChild(p);
      }
      setTimeout(()=> confetti.innerHTML="", 5200);
    }

    // --- No button impossible (teleports away)
    function moveNoButton(){
      const pad = 16;
      const w = noBtn.offsetWidth || 90;
      const h = noBtn.offsetHeight || 44;

      const maxX = Math.max(pad, window.innerWidth - w - pad);
      const maxY = Math.max(pad, window.innerHeight - h - pad);

      const x = Math.random() * (maxX - pad) + pad;
      const y = Math.random() * (maxY - pad) + pad;

      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
      noBtn.style.transform = "translate(0,0)";
    }

    ["mouseenter","mouseover","touchstart","pointerenter","pointerdown"].forEach(evt=>{
      noBtn.addEventListener(evt, (e)=>{ e.preventDefault(); moveNoButton(); }, {passive:false});
    });
    noBtn.addEventListener("click", (e)=>{ e.preventDefault(); moveNoButton(); });
    setTimeout(moveNoButton, 250);
    window.addEventListener("resize", moveNoButton);

    // --- Music: first tap enables sound
    let musicStarted = false;
    function startMusicWithSound(){
      if(musicStarted) return;
      musicStarted = true;
      musicTip.textContent = "Music on üé∂";
      ytPlayer.src = "https://www.youtube.com/embed/2kvtJL8Keog?autoplay=1&loop=1&playlist=2kvtJL8Keog&mute=0";
      setTimeout(()=> musicTip.style.display="none", 1200);
    }
    window.addEventListener("pointerdown", startMusicWithSound, {once:true});
    window.addEventListener("touchstart", startMusicWithSound, {once:true});

    // --- Safe POST helper (won't throw noisy errors)
    async function postJSON(payload){
      if(!hasEndpoint()) return { ok:false, skipped:true };
      try{
        const res = await fetch(FORMSPREE_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type":"application/json", "Accept":"application/json" },
          body: JSON.stringify(payload)
        });
        return { ok: res.ok, skipped:false };
      }catch(e){
        return { ok:false, skipped:false, error:true };
      }
    }

    // --- Notify once on YES
    let yesFired = false;
    yesBtn.addEventListener("click", async ()=>{
      if(yesFired) return;
      yesFired = true;

      yesBtn.disabled = true; // prevents double-click spam

      celebrate();
      result.textContent = "You just made Tanishq very happy üíû";
      finalScreen.style.display = "block";
      msgBox.style.display = "block";

      // Notify Tanishq
      const notify = await postJSON({
        event: "valentine_yes",
        to: "Tanishq",
        from: "Nisha (valentine page)",
        answer: "YES",
        time: new Date().toISOString()
      });

      // Test-proof feedback (only shown if endpoint missing)
      if(notify.skipped){
        statusEl.textContent = "Note: message delivery isn‚Äôt connected yet (Formspree link not added).";
      }
    });

    // --- Send her message back to you
    async function sendMessage(){
      const msg = (messageEl.value || "").trim();

      if(!msg){
        statusEl.textContent = "Write a message first üôÇ";
        return;
      }

      if(!hasEndpoint()){
        statusEl.textContent = "Tanishq hasn‚Äôt connected the inbox yet (Formspree link not added).";
        return;
      }

      sendMsgBtn.disabled = true;
      statusEl.textContent = "Sending‚Ä¶";

      const resp = await postJSON({
        event: "valentine_message",
        to: "Tanishq",
        from: "Nisha (valentine page)",
        message: msg,
        time: new Date().toISOString()
      });

      if(resp.ok){
        statusEl.textContent = "Sent to Tanishq üíå";
        messageEl.value = "";
      } else {
        statusEl.textContent = "Couldn‚Äôt send right now ‚Äî try again.";
      }

      sendMsgBtn.disabled = false;
    }

    sendMsgBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      sendMessage();
    });

    clearBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      messageEl.value = "";
      statusEl.textContent = "";
    });
  </script>
</body>
</html>